#参考文档
* https://mp.weixin.qq.com/s?__biz=MjM5MDE0Mjc4MA==&mid=2650995437&idx=1&sn=fefff4bff3e183d656a2d242e4c0a382&chksm=bdbf02be8ac88ba8d77252cf0279d708633364589a3c14e4e08fbe49e02dcf7ecfac50f141fe&scene=21#wechat_redirect
* https://blog.csdn.net/u011381576/article/details/80056967
* https://github.com/SongLiangChen/distributed_redbag_system
* https://github.com/pleuvoir/redpack
#前提与假设
* 每秒有100W次发红包,红包服务并发为1000，mysql并发为4000，kafka并发为30W
#特点
* 微信红包业务比普通商品“秒杀”有更海量的并发要求
* 实时性高
* 读写频繁
* 数据一致性
#抢红包流程设计
* 创建红包
* 抢红包
* 红包入库
* 账务增减
* 查红包
#架构设计
````

````
#设计处理难点
* 根据红包ID进行服务分流
    * 将服务划分为不同Set，每组Set中服务共用一个DB
    * Set中的服务服务根据红包ID Hash重新路由到某一个服务
    * 如此便可以将洪流拆分为娟娟溪流
* 创建红包
   * 算法：将剩余的钱除以剩余的红包数，然后再乘以2这个范围内取随机数就可以了
       ````
      int rand = (total.get() / count.get()) * 2;
      int price = random.nextInt(rand - 1) + 1; 
       ````
   *  提前创建好红包放入redis list
* 抢红包
    * 分布式锁 uid+红包id
    * list.lpop
    * 入队列方法增加如hystrix或sentinel的限流注解，通过红包放入队列
    * 
* 红包入库
    * 单线程红包入库
* 账务增减
    * mq通知账务服务    
* 分库分表查询红包信息
    * 冷热数据隔离
        * 创建一个“近期红包数据”的数据库，并且采用单库单表设计， 该库保留近一周或者一月的数据，平时做统计或者后台查看红包列表的时候，读取近期红包数据。
        * 另外还可以按月或者按年生成报表形式存储数据，以后直接查看报表
    * 分库表规则： db_xx.t_y_dd：xx/y是红包ID的hash值后三位，dd的取值范围在01~31，代表一个月天数最多31天。
    * 分表键规则： 红包id保证全局唯一，同时，红包id的最后三位数格式为XXY，代表了它具体落地的数据库。
           