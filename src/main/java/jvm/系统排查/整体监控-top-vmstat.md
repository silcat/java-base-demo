#top命令
* 格式: top option  
  * option：
  ````
   -c  查看最耗cpu的进程
   -p 进程号,... 指定进程
   -n 次数　　   循环显示的次数
   -i 秒数　　　 屏幕刷新间隔时间
   -b　　　　　　以批处理模式操作  
  ````
#vmstat命令
* 格式: vmstat option  
  * option：
  ````
    -a 显示活跃内存（active）和非活跃内存（inact）
    -f 显示从系统启动至今的fork数量 
    -m 显示slabinfo
    -s 静态显示内存相关信息
 
  ````  
##命令示例
* top -d 2 -n 3 -b > test.txt  将top以2秒间隔循环3次保存到test.txt文件
##系统状态
````
第一行: top - 19:36:00 up 49 days,  7:44,  1 user,  load average: 0.34, 0.38, 0.40
第二行： Tasks: 216 total,   3 running, 213 sleeping,   0 stopped,   0 zombie
第三行： %Cpu(s):  4.0 us,  6.1 sy,  0.0 ni, 88.0 id,  1.5 wa,  0.0 hi,  0.4 si,  0.0 st 
第四行：KiB Mem:  12260128 total,  6160704 used,  6099424 free,   331448 buffers
第五行：KiB Swap:        0 total,        0 used,        0 free.  1393220 cached Mem

第六行： PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+  COMMAND                                                                                           
         3460 java      20   0   33508   2180   1536 S  47.2  0.0   5765:44   ntpd                                                                                              
        12781 ceilome+  20   0  137464  60096   4740 S   5.0  0.5   833:30.17 ceilometer-agen                                                                                   
         2816 rabbitmq  20   0 2482652 274620   2612 S   1.7  2.2   1222:49   beam.smp 
 ======================第一行（当前系统负载）==========================================
 1.load average（系统平均负载）：在一段时间内处于运行或不可打扰状态的进程的平均数（1分钟，5分钟，15分钟），
  - 可运行：运行态，占用CPU，或就绪态，等待CPU调度。
  - 不可打扰：阻塞，正在等待I/O
 2.平均负载： load average /CPU核数 < 0.7 或 load average < 2 * CPU核数 - 2
 3.uptime 命令也可以打印出第一行
 ======================第三行（当前进程运行状态）==========================================
 ======================第三行（当前CPU运行状态）==========================================
1.参数含义
id：CPU空闲比率，如果系统缓慢而这个值很高，说明系统慢的原因不是CPU负载高； ****
wa：CPU等待执行I/O操作的时间比率，该指标可以用来排查磁盘I/O的问题，通常结合wa和id判断 ****
us：用户进程占用CPU的比率     
sy：内核、内核进程占用CPU的比率；
2.系统缓慢排查
  - us高，wa低，说明进程占用大量CPU 
  - wa低，id高，非CPU瓶颈
  - wa高 说明IO占用大量CPU时间 
     （1）检查是否使用硬盘交换空间，一般建议关闭交换空间（当内存耗尽使用硬盘）
          查看硬盘分区：lsblk 或free
          关闭交换空间：swapoff -a /dev/sda2 关闭sda硬盘sda2交换分区
     （2）检查内存是否充足，若内存充足需要检查哪个进程占用大量IO资源
======================第四行（内存使用状态）==========================================
total：总内存大小，free：空闲的内存，used：已使用的内存，buff/cache：缓存的内存大小                                                                                 
======================第五行（交换空间（虚拟内存）使用状态）==============================
total：总内存大小，free：空闲的内存，used：已使用的内存，buff/cache：缓存的内存大小  
======================第六行（进程信息）===============================================
PID:     进程id
%CPU:　　进程使用的CPU占用百分比
%MEM: 　 进程使用的物理内存百分比
TIME+: 　进程使用的CPU时间总计
S:进程状态，D：不可中断的睡眠状态，R：运行，S：睡眠，T：跟踪/停止，Z：僵尸进程
VIRT:进程使用的虚拟内存总量;   
RES:进程使用的物理内存大小  
SHR:共享内存大小
TIME+：进程使用的CPU时间总计
````
  
## 命令示例
* vmstat 1 10 （查看内存使用的动态变化）
##系统状态
````
procs -----------memory---------- ---swap-- -----io---- -system--     ------cpu-----
  r  b   swpd   free   buff  cache     si   so    bi    bo   in   cs   us sy id wa st
  2  0  15116 731952   1340 28115028    0    0     0     9    2    2    1  1 98  0  0
  0  0  15116 729968   1340 28115144    0    0     0   150 15618 25541  1  1 98  0  0
  3  0  15116 728676   1340 28115188    0    0     0   111 14025 23276  1  1 98  0  0
  1  0  15116 727388   1340 28115484    0    0     0    97 16868 25279  2  1 97  0  0
  0  0  15116 728268   1340 28115548    0    0     0    98 14459 23415  1  1 98  0  0
  0  0  15116 727664   1340 28115740    0    0     0   780 13770 23239  1  1 98  0  0
  0  0  15116 726724   1340 28115708    0    0     0   160 15027 23780  1  1 98  0  0
  0  0  15116 722680   1340 28115964    0    0     0   114 14465 22727  1  1 98  0  0
  0  0  15116 725244   1340 28116004    0    0     0    99 13835 22848  1  1 98  0  0
  1  0  15116 724048   1340 28116016    0    0     0    98 13483 22620  1  1 98  0  0
====================================================================================

procs（进程）
r：当前运行队列中线程的数目不包括等待IO的进程，代表线程处于可运行状态，但CPU还未能执行.，这个值可以作为判断CPU是否繁忙的一个指标；当这个值超过了CPU数目，就会出现CPU瓶颈了；这个我们可以结合top命令的负载值同步评估系统性能；
b：等待IO的进程数量；如果该值一直都很大，说明IO比较繁忙，处理较慢；

memory（内存）
swpd：虚拟内存已使用的大小；如果swpd的值不为0，但是si，so的值长期为0，这种情况不会影响系统性能；
free：空闲的物理内存的大小；
buff：用作缓冲的内存大小；
cache：用作缓存的内存大小；如果cache的值大的时候，说明cache处的文件数多，如果频繁访问到的文件都能被cache处，那么磁盘的读IO bi会非常小；

swap（交换空间，单位：KB）；
si：每秒从交换区写到内存的大小；
so：每秒写入交换区的内存大小；
内存够用的时候，这2个值都是0，如果这2个值长期大于0时，系统性能会受到影响，磁盘IO和CPU资源都会被消耗；
有时我们看到空闲内存（free）很少的或接近于0时，就认为内存不够用了，不能光看这一点，还要结合si和so；
如果free很少，但是si和so也很少（大多时候是0），那么不用担心，系统性能这时不会受到影响的；

io（单位：块/秒）
bi：每秒读取的块数；
bo：每秒写入的块数；随机磁盘读写的时候，这2个值越大，能看到CPU在IO等待的值也会越大；

system（系统）；这2个值越大，会看到由内核消耗的CPU时间会越大；
in：每秒中断数，包括时钟中断；
cs：每秒上下文切换数；

cpu（以百分比表示）
us：用户进程执行时间(user time)；
sy：系统进程执行时间(system time)；
id：空闲时间(包括IO等待时间)；
wa：等待IO时间；wa的值高时，说明IO等待比较严重，这可能由于磁盘大量作随机访问造成，也有可能磁盘出现瓶颈。   
````
* top -Hp 17（查看pid下线程信息）
````
  PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND                                                                          
   17 app       20   0   12.2g 953728  17568 S  0.0  0.7   0:00.00 java                                                                             
   24 app       20   0   12.2g 953728  17568 S  0.0  0.7   0:10.66 java                                                                             
   25 app       20   0   12.2g 953728  17568 S  0.0  0.7   0:01.38 java                                                                             
   26 app       20   0   12.2g 953728  17568 S  0.0  0.7   0:01.36 java                                                                             
   27 app       20   0   12.2g 953728  17568 S  0.0  0.7   0:01.28 java                                                                              
````




